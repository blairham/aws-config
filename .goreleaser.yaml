# .goreleaser.yml
version: 2

before:
  hooks:
  # You may remove this if you don't use go modules.
  - go mod tidy
  # you may remove this if you don't need go generate
  - go generate ./...

builds:
# You can have multiple builds defined as a yaml list
- env:
  - CGO_ENABLED=0
  goos:
  - darwin
  goarch:
  - amd64
  - arm64

archives:
- format: binary

brews:
# Allows you to set a custom download strategy. Note that you'll need
# to implement the strategy and add it to your tap repository.
# Example: https://docs.brew.sh/Formula-Cookbook#specifying-the-download-strategy-explicitly
- download_strategy: CurlDownloadStrategy

  # Git author used to commit to the repository.
  commit_author:
    name: goreleaserbot
    email: bot@goreleaser.com

  # The project name and current git tag are used in the format string.
  #
  # Templates: allowed
  commit_msg_template: "Brew formula update for {{ .ProjectName }} version {{ .Tag }}"

  # Folder inside the repository to put the formula.
  directory: Formula

  # Setting this will prevent goreleaser to actually try to commit the updated
  # formula - instead, the formula file will be stored on the dist folder only,
  # leaving the responsibility of publishing it to the user.
  # If set to auto, the release will not be uploaded to the homebrew tap
  # in case there is an indicator for prerelease in the tag e.g. v1.0.0-rc1
  #
  # Templates: allowed
  skip_upload: auto

  # So you can `brew test` your formula.
  #
  # Template: allowed
  test: |
    system "#{bin}/aws-config --help"

  # Repository to push the generated files to.
  repository:
    # Repository owner.
    #
    # Templates: allowed
    owner: cloud

    # Repository name.
    #
    # Templates: allowed
    name: homebrew

    # Optionally a branch can be provided.
    #
    # Default: default repository branch
    # Templates: allowed
    branch: main

gitlab_urls:
  api: https://gitlab.dev.tripadvisor.com/api/v4/
  download: https://gitlab.dev.tripadvisor.com

  # set to true if you use a self-signed certificate
  skip_tls_verify: false

  # set to true if you want to upload to the Package Registry rather than attachments
  # Only works with GitLab 13.5+
  #
  # Since: v1.3
  use_package_registry: true
